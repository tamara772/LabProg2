//teste_basico_libtest.c
#include <stdio.h>
#include <string.h>
#include "libpilha.h"
#include "libtestpilha.h"


// Executa um único teste com base na operação
int executarTeste(Teste* t, Pilha* pilha) {
    if (strcmp(t->operacao, "PUSH") == 0) {
        push(pilha, t->valor1);
        return 1;  // sucesso
    } 
    else if (strcmp(t->operacao, "POP") == 0) {
        int valor = pop(pilha);
        return (valor == t->esperado);
    } 
    else if (strcmp(t->operacao, "TOP") == 0) {
        int valor = top(pilha);
        return (valor == t->esperado);
    } 
   
    else {
        printf("Operação desconhecida: %s\n", t->operacao);
        return 0;
    }
}

// Escreve no arquivo se o teste passou ou não.
void registrarResultado(FILE* out, Teste* t, int sucesso) {
    fprintf(out, "%s %d %d -> %s\n",
            t->operacao,
            t->valor1,
            t->esperado,
            sucesso ? "SUCESSO" : "FALHA");
}

// Lê o arquivo de entrada, executa e salva resultados
void rodarTestes(const char* arquivoEntrada, const char* arquivoSaida) {
    FILE* in = fopen(arquivoEntrada, "r");
    if (!in) {
        printf("Erro ao abrir arquivo de entrada: %s\n", arquivoEntrada);
        return;
    }

    FILE* out = fopen(arquivoSaida, "w");
    if (!out) {
        printf("Erro ao criar arquivo de saída: %s\n", arquivoSaida);
        fclose(in);
        return;
    }

    Pilha* pilha=criarPilha();
    Teste t = {0}; 


    while (fscanf(in, "%s %d %d",
                  t.operacao, &t.valor1, &t.esperado) == 3) {
        int sucesso = executarTeste(&t, pilha);
        registrarResultado(out, &t, sucesso);
    }

    fclose(in);
    fclose(out);
}

int main(void)
{   
    rodarTestes("testes.txt", "resultados.txt");
    printf("Fim dos testes. Resultados em resultados.txt\n");
    return 0;
}
